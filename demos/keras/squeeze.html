<body>
<script src="../../dist/demo-util.js"></script>
<script src="../../dist/tensor.js"></script>

<style type="text/css">
    body {
        font-family: sans-serif;
    }
</style>

<script src="layers.js"></script>
<script src="util.js"></script>
<script src="network.js"></script>
<script src="keras_import.js"></script>
<script>
var gl = KV.createGL(),
    OutputTensor = KV.OutputTensor,
    Tensor = KV.Tensor,
    InPlaceTensor = KV.InPlaceTensor,
    TP = s => (out, opt) => KV.Run(s.join(''), out, opt);
gl.canvas.width = 512
gl.canvas.height = 512


async function squeezenet(){
    var keras_model = await loadJSON('models/squeeze.json');
    var keras_model_meta = await loadJSON('models/squeeze_metadata.json');
    var buffer = await loadBuffer('models/squeeze_weights.buf');

    console.log(keras_model, keras_model_meta, buffer)
    
    var image = (await loadArrayFromURL('data/cat-227x227x3')).transpose(1, 0, 2);
    ;(new Tensor(gl, image)).show({ offset: 0.5, scale: 1/256, flipY: true })


    var network = import_keras_network(keras_model, keras_model_meta, buffer)


    var compiled = await compile(gl, network, { input_1: image })
    C = compiled
    await run(gl, compiled, { input_1: image })
    // await destroy(gl, compiled)


}

squeezenet()

</script>